# SPI DUT (Design Under Test)

## Overview

This repository contains a simple SPI (Serial Peripheral Interface) Design Under Test (DUT) written in SystemVerilog. The DUT implements both master and slave modes for SPI communication, allowing data transmission between a master and slave device via the SPI protocol. The DUT is used for verification and testing purposes.

## SPI Signals

The SPI DUT has the following signals:

- **clk**: The clock signal that drives the operation of the SPI interface.
- **reset_n**: Active-low reset signal for initializing the DUT.
- **cs_n**: Chip Select (CS) signal, active-low. This signal is used by the master to select the slave device.
- **mosi**: Master Out Slave In. This signal is used to send data from the master to the slave.
- **miso**: Master In Slave Out. This signal is used to send data from the slave to the master.
- **sclk**: Serial Clock signal. The clock signal is generated by the master and synchronizes data transmission.
- **mode**: A mode signal to select whether the DUT operates as a master (1) or a slave (0).
- **reg_addr**: The register address for reading or writing to the SPI registers.
- **reg_write**: Active-high signal indicating that a register write operation is happening.
- **reg_wdata**: Data written to the register.
- **reg_rdata**: Data read from the register.
- **ready**: Indicates whether the DUT is ready for the next operation (active-high).

### SPI Timing Waveform

The timing diagram below shows the sequence of SPI signals during a typical data transmission:
![image](https://github.com/user-attachments/assets/b52096ad-2bc0-4b22-bb47-b681b16a3963)
This detailed diagram shows the SPI communication with the main signals:

- **CS_N (Chip Select)**: Stays low while the transaction is ongoing.
- **SCLK (SPI Clock)**: Alternates between high and low to synchronize the data.
- **MOSI (Master Output, Slave Input)**: The Master transmits `11010010` to the Slave.
- **MISO (Master Input, Slave Output)**: The Slave responds with `10101100` to the Master.


### Signal Descriptions

- **SCLK**: The clock signal used for synchronizing data transfer. The master generates the clock, and it is shared by both the master and the slave.
- **MOSI**: The data line from the master to the slave. The master sends data on this line, and the slave receives it.
- **MISO**: The data line from the slave to the master. The slave sends data on this line, and the master receives it.
- **CS**: The chip select signal used to select the slave device for communication. This signal is active-low.
- **clk**: The clock signal that drives the operation of the DUT.
- **reset_n**: The active-low reset signal used to reset the DUT to its initial state.

## Register Map

The SPI DUT has several registers that control its operation. Below is a description of each register and its functionality.

### Register Map Table

| Register      | Address | Description                                            |
|---------------|---------|--------------------------------------------------------|
| `ctrl_reg`    | 0x00    | Control register to configure SPI parameters (master/slave, data order, etc.) |
| `status_reg`  | 0x04    | Status register to monitor SPI status (e.g., ready, errors) |
| `data_in_reg` | 0x08    | Register holding data received from the master or slave |
| `data_out_reg`| 0x0C    | Register holding data to be transmitted to the master or slave |
| `clk_div_reg` | 0x10    | Clock divider register to set the SPI clock frequency |

### Register Bit Descriptions

#### `ctrl_reg` (Control Register)

| Bit | Name       | Description                                          |
|-----|------------|------------------------------------------------------|
| [0] | `spi_en`   | SPI enable (1 = enabled, 0 = disabled)               |
| [1] | `mode`     | Mode selection (0 = Slave, 1 = Master)              |
| [2] | `lsb_first`| Data order (0 = MSB first, 1 = LSB first)           |

#### `status_reg` (Status Register)

| Bit | Name       | Description                                          |
|-----|------------|------------------------------------------------------|
| [0] | `ready`    | Indicates if the DUT is ready (1 = ready, 0 = not ready) |
| [1] | `error`    | Error flag (1 = error, 0 = no error)                 |

#### `data_in_reg` (Data Input Register)

| Bit  | Name      | Description                                          |
|------|-----------|------------------------------------------------------|
| [7:0] | `data_in` | Data received from the SPI interface (MISO)          |

#### `data_out_reg` (Data Output Register)

| Bit  | Name      | Description                                          |
|------|-----------|------------------------------------------------------|
| [7:0] | `data_out` | Data to be transmitted via SPI interface (MOSI)      |

#### `clk_div_reg` (Clock Divider Register)

| Bit  | Name      | Description                                          |
|------|-----------|------------------------------------------------------|
| [7:0] | `clk_div` | Clock division factor to set the SPI clock speed     |

## Functionality

The SPI DUT operates in two modes: **Master** and **Slave**. The behavior of the DUT depends on the `mode` signal.

### In Master Mode:
- The DUT generates the clock signal (`sclk`) and drives data out through the `mosi` line.
- It shifts out data from `data_in_reg` to the `miso` line.
- The DUT uses the `clk_div_reg` to control the frequency of the SPI clock.
  
### In Slave Mode:
- The DUT listens for a clock signal (`sclk`) and shifts in data through the `mosi` line.
- It drives data out to the master through the `miso` line from `data_in_reg`.

### Register Operations

- **Control Register** (`ctrl_reg`): Used to configure SPI parameters such as enabling the SPI interface, setting the mode (master or slave), and determining the data order (MSB or LSB first).
- **Status Register** (`status_reg`): Indicates if the DUT is ready for a new operation or if there is an error.
- **Data Registers** (`data_in_reg` and `data_out_reg`): Used for transmitting and receiving data.
- **Clock Divider Register** (`clk_div_reg`): Used to adjust the SPI clock speed by dividing the input clock signal.

## Conclusion

This SPI DUT provides a fundamental implementation of the SPI protocol for both master and slave modes. It can be used for verification in a UVM environment and serves as a foundation for more complex SPI-based designs.

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details.
